{% extends 'navbar.html' %}
{% load static %}
{% block title %}Customers List{% endblock %}
{% block link %}
<link rel="stylesheet" href="{% static 'css/product.css' %}">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="col-lg-10 col-md-9 col-sm-9 page-col">
  <h2 class="p-4">üë• Customers List</h2>
  <div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <form action="{% url 'customers' %}" method="get" class="d-flex">
        <label for="customer-search" class="visually-hidden">Search</label>
        <input type="text" id="customer-search" class="search-input form-control"
               name="search" placeholder="üîç Search here..." autocomplete="off"
               style="width:75%;">
        <button type="submit" class="btn btn-primary ms-2"
                style="background-color: #1d4876; border:none;">
          Search
        </button>
      </form>
    </div>

    {% if customers %}
    <div class="card shadow-sm border-0 rounded-3">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th scope="col">Customer ID</th>
              <th scope="col">Fullname</th>
              <th scope="col">Phone</th>
              <th scope="col">Address</th>
              <th scope="col">Wallet</th>
              <th scope="col">Actions</th>
            </tr>
          </thead>
          <tbody class="table-group-divider">
            {% for customer in customers %}
              <tr>
                <td class="text-nowrap">{{ customer.id }}</td>
                <td class="text-nowrap">{{ customer.fullname }}</td>
                <td class="text-nowrap">+91 {{ customer.phone }}</td>
                <td class="text-nowrap">{{ customer.address }}</td>
                <td class="text-nowrap">‚Çπ{{ customer.wallet }}</td>
                <td class="text-nowrap">
                  <button class="btn btn-sm " data-bs-toggle="modal" data-bs-target="#editCustomerModal{{ customer.id }}" style="border:1px solid black; color: black">‚úèÔ∏è Edit</button>
                  {% if customer.wallet < 0 %}
                    <a href="{% url 'edit_wallet' customer.id %}" class="btn btn-sm btn-product">üí∞ Fix Wallet</a>
                  {% endif %}
                </td>
              </tr>
              <!-- Bootstrap Modal for Editing -->
              <div class="modal fade" id="editCustomerModal{{ customer.id }}" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                  <div class="modal-content">
                    <form method="post" action="{% url 'edit_customer' customer.id %}">
                      {% csrf_token %}
                      <div class="modal-header">
                        <h5 class="modal-title">Edit Customer</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                      </div>
                      <div class="modal-body">
                        <div class="mb-3">
                          <label class="form-label">Full Name</label>
                          <input type="text" name="fullname" class="form-control" value="{{ customer.fullname }}" required>
                        </div>
                        <div class="mb-3">
                          <label class="form-label">Phone</label>
                          <input type="text" name="phone" class="form-control" value="{{ customer.phone }}" required>
                        </div>
                        <div class="mb-3">
                          <label class="form-label">Address</label>
                          <textarea name="address" class="form-control" required>{{ customer.address }}</textarea>
                        </div>
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    {% else %}
    <div class="alert alert-warning text-center mt-4" role="alert">
      üö´ No Customer Found!
    </div>
    {% endif %}
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}
